#include <iostream>
#include <vector>
#include <string>
#include <random>
#include <ctime>
#include <chrono>
#include <thread>
#include <unistd.h>

using namespace std;

int kdSetPlayPet = 0; // Cooldown for playing with the pet
const int COOLDOWN_TIME = 60; 

int kdSetPlayGame = 0; // Cooldown for the ball game
const int GAME_COOLDOWN_TIME = 120; // Cooldown duration in seconds

void cleanerKD() {
    kdSetPlayPet--;
    kdSetPlayGame--;
}

// Структура для питомца

struct Item {
    string name;
    int quantity;
    int effect;
    int rarity;
};


struct Pet {
    std::string name;
    int level;
    int health;
    int xp;
    int happiness;
    int trips;
    int coins;
};


struct Enemy {
    string name;
    int level;
    int health;
};


// Функция для отображения ASCII-арта питомца
void drawPet() {
    std::cout << "       ," << std::endl;
    std::cout << "       \\`-._           __" << std::endl;
    std::cout << "        \\  `-..____,.'  `." << std::endl;
    std::cout << "        :`.         /    \\`." << std::endl;
    std::cout << "         :  )       :      : \\" << std::endl;
    std::cout << "          ;'        '   ;  |  :" << std::endl;
    std::cout << "          )..      .. .:.`.;  :" << std::endl;
    std::cout << "         /::...  .:::...   ` ;" << std::endl;
    std::cout << "         ; _ '    __        /:\\" << std::endl;
    std::cout << "         `:o>   /\\o_>      ;:. `." << std::endl;
    std::cout << "        `-`.__ ;   __..--- /:.   \\" << std::endl;
    std::cout << "        === \\_/   ;=====_.':.     ;" << std::endl;
    std::cout << "         ,/'`--'...`--....        ;" << std::endl;
    std::cout << "              ;                    ;" << std::endl;
    std::cout << "            .'                      ;" << std::endl;
    std::cout << "          .'                        ;" << std::endl;
    std::cout << "        .'     ..     ,      .       ;" << std::endl;
    std::cout << "       :       ::..  /      ;::.     |" << std::endl;
    std::cout << "      /      `.;::.  |       ;:..    ;" << std::endl;
    std::cout << "     :         |:.   :       ;:.    ;" << std::endl;
    std::cout << "     :         ::     ;:..   |.    ;" << std::endl;
    std::cout << "      :       :;      :::....|     |" << std::endl;
    std::cout << "      /\\     ,/ \\      ;:::::;     ;" << std::endl;
    std::cout << "    .:. \\:..|    :     ; '.--|     ;" << std::endl;
    std::cout << "   ::.  :''  `-.,,;     ;'   ;     ;" << std::endl;
    std::cout << ".-'. _.'\\      / `;      \\,__:      \\" << std::endl;
    std::cout << "`---'    `----'   ;      /    \\,.,,,/" << std::endl;
    std::cout << "                   `----`            " << std::endl;
}

int xpToNextlevel(int currentLevel) {
    return 10 * (currentLevel + 1) * (currentLevel + 1);
}

// Функция для отображения питомца
void displayPet(const Pet& pet) {
    Pet myPet;

    std::cout << "\n\nИмя питомца: " << pet.name << std::endl;
    std::cout << "Уровень: " << pet.level << std::endl;
    std::cout << "Здоровье: " << pet.health << std::endl;
    std::cout << "Счастье: " << pet.happiness << std::endl;
    cout << "Монеты: " << pet.coins << endl;
    cout << "Опыт: " << pet.xp << endl;
    drawPet(); // Отрисовка питомца
}

// Функция для отображения меню
void displayMenu() {
   cout << "\033[34m1. Играть с питомцем\033[0m" << endl;
   cout << "\033[34m2. Отправиться в путешествие.\033[0m" << endl;
   cout << "\033[34m3. Испытать удачу.\033[0m" << endl;
   cout << "\033[34m4. Купить перки.\033[0m" << endl;
   cout << "\033[34m5. Инвентарь.\033[0m" << endl;
   cout << "\033[34m6. Крафт.\033[0m" << endl;
   cout << "\033[34m7. Выйти из игры.\033[0m" << endl;
}


int play(Pet& myPet) {
    int xpGain = 20;
    myPet.xp += xpGain;
    return myPet.xp;
}

void addItem(vector<Item>& inventory, string itemName, int quantity) {
    for (auto& item : inventory) {
        if (item.name == itemName) {
            item.quantity += quantity;
            return;
        }
    }

    inventory.push_back({ itemName, quantity, 0, 0 });
}

void addItem(vector<Item>& inventory, string itemName, int quantity, int effect, int rarity) {
    for (auto& item : inventory) {
        if (item.name == itemName) {
            item.quantity += quantity;
            return;
        }
    }

    inventory.push_back({itemName, quantity, effect, rarity});
}

int itemQuantity(const std::vector<Item>& items, const std::string& itemName) {
    for (const auto& item : items) {
        if (item.name == itemName) {
            return item.quantity;
        }
    }
    return 0;
}


void shop(vector<Item>& inventory, Pet& myPet) {

    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;
  
    int lobby;
    cout << "Магазин:" << endl;
    cout << "1. Нож - 100 монет" << endl;
    cout << "2. Лук - 150 монет" << endl;
    cout << "3. Меч - 200 монет" << endl;
    cout << "4. Щит - 120 монет" << endl;
    cout << "5. Доспехи - 250 монет" << endl;
    cout << "6. Читай информацию о перках" << endl;

    int choice;
    cout << "Выберите товар для покупки: ";
    cin >> choice;

    switch (choice) {
    case 1:
        if (myPet.coins >= 100) {
            myPet.coins -= 100;
            addItem(inventory, "Нож", 1);
            cout << "Вы купили Нож!" << endl;
        }
        else {
            cout << "У вас недостаточно монет для покупки." << endl;
            cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
            cin >> lobby;

            if (lobby == 1) {
                break;
            }
        }
        break;
    case 2:
        if (myPet.coins >= 150) {
            myPet.coins -= 150;
            addItem(inventory, "Лук", 1);
            cout << "Вы купили Лук!" << endl;
        }
        else {
            cout << "У вас недостаточно монет для покупки." << endl;
            cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
            cin >> lobby;

            if (lobby == 1) {
                break;
            }
        }
        break;
    case 3:
        if (myPet.coins >= 200) {
            myPet.coins -= 200;
            addItem(inventory, "Меч", 1);
            cout << "Вы купили Меч!" << endl;
        }
        else {
            cout << "У вас недостаточно монет для покупки." << endl;
            cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
            cin >> lobby;

            if (lobby == 1) {
                break;
            }
        }
        break;

    case 4:
        if (myPet.coins >= 120) {
            myPet.coins -= 120;
            addItem(inventory, "Щит", 1);
            cout << "Вы купили Щит!" << endl;
        }
        else {
            cout << "У вас недостаточно монет для покупки." << endl;
            cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
            cin >> lobby;

            if (lobby == 1) {
                break;
            }
        }
        break;
    case 5:
        if (myPet.coins >= 250) {
            myPet.coins -= 250;
            addItem(inventory, "Доспехи", 1);
            cout << "Вы купили Доспехи!" << endl;
        }
        else {
            cout << "У вас недостаточно монет для покупки." << endl;
            cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
            cin >> lobby;

            if (lobby == 1) {
                break;
            }
        }
        break;
    case 6:
        cout << "Перки:" << endl;
        cout << "1. Нож - бьёт монстров с 1.5х урона" << endl;
        cout << "2. Лук - бьёт монстров с 2x урона" << endl;
        cout << "3. Меч - бьёт монстров с 3x урона" << endl;
        cout << "4. Щит - защита от монстров" << endl;
        cout << "5. Доспехи - защита от монстров" << endl;
        break;
    default:
        cout << "Неверный выбор товара." << endl;
    }
}


int miniGame(Pet& myPet) {

  std::cout << '-' << std::flush;
  sleep(1);
  std::cout << "\b\\" << std::flush;
  sleep(1);
  std::cout << "\b|" << std::flush;
  sleep(1);
  std::cout << "\b/" << std::flush;
  sleep(1);
  std::cout << "\b-" << std::flush;
  
    if (kdSetPlayGame > 0) {
        cout << "Игра с шариками находится на перезарядке. Попробуйте позже." << endl;
        return 0;
    }

    cout << "В этой игре вы должны угадать в каком стаканчике находится шарик. Всего 5 стаканчиков.\n Если вы угадаете, то получаете опыт и монеты.\n У вас есть всего три попытки, иначе я заберу у вас одну монету. Удачи!" << endl;

    int stakan = rand() % 5 + 1;
    int userChoice;
    for (int i = 0; i < 3; i++) {
        cout << "В каком стаканчике находится шарик: " << endl;
        cin >> userChoice;
        if (userChoice == stakan) {
            cout << "\nВы угадали!" << endl;
            cout << "Вы получаете 10 опыта и 1 монету." << endl;
            myPet.coins += 1;
            myPet.xp += 10;
            cout << "Осталось опыта до следующего уровня: " << xpToNextlevel(myPet.level) << endl;

            kdSetPlayGame = GAME_COOLDOWN_TIME;

            thread cooldownTimer([&] {
                this_thread::sleep_for(chrono::seconds(GAME_COOLDOWN_TIME));
                kdSetPlayGame = 0;
                });
            cooldownTimer.detach();
            break;
        }
        else {
            cout << "Вы не угадали. У вас осталось " << 2 - i << " попыток." << endl;
        }
    }

    if (userChoice != stakan) {
        myPet.coins -= 1;
    }

    return 0;
}


void printInventory(vector<Item>& inventory) {
    cout << "\nИнвентарь:" << endl;
    for (auto& item : inventory) {
        cout << item.name << " - " << item.quantity << endl;
    }
}

void battleOneLvl(Pet& myPet) {


    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;
  
    int lobby;
    int choice;
    int mhp, hp, init, atk, def, matk, mdef, hurt, mhurt, agi, magi;
    atk = 10;
    def = 15;
    agi = 5;
    matk = 10;
    mdef = 15;
    magi = 5;

    srand((unsigned)time(0));
    init = rand() % 2 + 1;
    mhp = rand() % 50 + 60;
    hp = rand() % 20 + 80;
    if (init == 1) {
        cout << "Ты начинаешь.\n==========\n";
        while (hp > 0 || mhp > 0) {
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урон монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "У тебя осталось: " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n" << endl;
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню.";
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
        }
    }
    else {
        cout << "Монстр начинает.\n==============\n";
        while (hp > 0 || mhp > 0) {
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n";
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У тебя сейчас " << hp << " хп.\n\n";
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урона монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "Ты убил монстра!! Ты победил с " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
        }
    }
}

void battleTwoLvl(Pet& myPet) {

    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;
  
    int lobby;
    int choice;
    int mhp, hp, init, atk, def, matk, mdef, hurt, mhurt, agi, magi;
    atk = 10;
    def = 15;
    agi = 5;
    matk = 10;
    mdef = 15;
    magi = 5;

    srand((unsigned)time(0));
    init = rand() % 2 + 1;
    mhp = rand() % 50 + 60;
    hp = rand() % 20 + 80;
    if (init == 1) {
        cout << "Ты начинаешь.\n==========\n";
        while (hp > 0 || mhp > 0) {
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урон монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "У тебя осталось: " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n" << endl;
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню.";
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
        }
    }
    else {
        cout << "Монстр начинает.\n==============\n";
        while (hp > 0 || mhp > 0) {
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n";
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У тебя сейчас " << hp << " хп.\n\n";
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урона монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "Ты убил монстра!! Ты победил с " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
        }
    }
}

void battleThreeLvl(Pet& myPet) {
    int lobby;
    int choice;
    int mhp, hp, init, atk, def, matk, mdef, hurt, mhurt, agi, magi;
    atk = 10;
    def = 15;
    agi = 5;
    matk = 10;
    mdef = 15;
    magi = 5;

    srand((unsigned)time(0));
    init = rand() % 2 + 1;
    mhp = rand() % 50 + 60;
    hp = rand() % 20 + 80;
    if (init == 1) {
        cout << "Ты начинаешь.\n==========\n";
        while (hp > 0 || mhp > 0) {
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урон монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "У тебя осталось: " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n" << endl;
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню.";
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
        }
    }
    else {
        cout << "Монстр начинает.\n==============\n";
        while (hp > 0 || mhp > 0) {
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n";
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У тебя сейчас " << hp << " хп.\n\n";
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урона монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "Ты убил монстра!! Ты победил с " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
        }
    }
}

void battleFourLvl(Pet& myPet) {

    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;
  
    int lobby;
    int choice;
    int mhp, hp, init, atk, def, matk, mdef, hurt, mhurt, agi, magi;
    atk = 10;
    def = 15;
    agi = 5;
    matk = 10;
    mdef = 15;
    magi = 5;

    srand((unsigned)time(0));
    init = rand() % 2 + 1;
    mhp = rand() % 50 + 60;
    hp = rand() % 20 + 80;
    if (init == 1) {
        cout << "Ты начинаешь.\n==========\n";
        while (hp > 0 || mhp > 0) {
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урон монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "У тебя осталось: " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n" << endl;
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню.";
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
        }
    }
    else {
        cout << "Монстр начинает.\n==============\n";
        while (hp > 0 || mhp > 0) {
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n";
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У тебя сейчас " << hp << " хп.\n\n";
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урона монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "Ты убил монстра!! Ты победил с " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
        }
    }
}

void battleFiveLvl(Pet& myPet) {


    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;
  
    int lobby;
    int choice;
    int mhp, hp, init, atk, def, matk, mdef, hurt, mhurt, agi, magi;
    atk = 10;
    def = 15;
    agi = 5;
    matk = 10;
    mdef = 15;
    magi = 5;

    srand((unsigned)time(0));
    init = rand() % 2 + 1;
    mhp = rand() % 50 + 60;
    hp = rand() % 20 + 80;
    if (init == 1) {
        cout << "Ты начинаешь.\n==========\n";
        while (hp > 0 || mhp > 0) {
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урон монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "У тебя осталось: " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n" << endl;
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню.";
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
        }
    }
    else {
        cout << "Монстр начинает.\n==============\n";
        while (hp > 0 || mhp > 0) {
            choice = rand() % 3;
            switch (choice) {
            case 1:
                matk = rand() % 20 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 5;
                break;
            case 2:
                matk = rand() % 5 + 10;
                mdef = rand() % 10 + 10;
                magi = rand() % 15;
                break;
            case 3:
                matk = rand() % 10 + 10;
                mdef = rand() % 20 + 10;
                magi = rand() % 5;
                break;
            }
            hurt = (matk - agi) - (def / matk);
            if (hurt < 0) {
                hurt = 0;
            }
            hp = hp - hurt;
            cout << "Монстр нанес вам " << hurt << " урона.\n";
            if (hp < 1) {
                cout << "Ты умер. У монстра осталось " << mhp << " хп.\n";
                cout << "Монстр забрал у тебя 5 монет и 50 xp." << endl;
                myPet.coins -= 5;
                myPet.xp -= 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У тебя сейчас " << hp << " хп.\n\n";
            cout << "Что ты хочешь сделать?\n1 - Яростная атака\n2 - Гибкая атака\n3 - Защитные приемы\n";
            do { cin >> choice; } while (choice > 3 || choice < 1);
            switch (choice) {
            case 1:
                atk = rand() % 20 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 5;
                break;
            case 2:
                atk = rand() % 5 + 10;
                def = rand() % 10 + 10;
                agi = rand() % 15;
                break;
            case 3:
                atk = rand() % 10 + 10;
                def = rand() % 20 + 10;
                agi = rand() % 5;
                break;
            }
            mhurt = (atk - magi) - (mdef / atk);
            if (mhurt < 0) {
                mhurt = 0;
            }
            mhp = mhp - mhurt;
            cout << "Ты нанес " << mhurt << " урона монстру!\n";
            cin.get();
            if (mhp < 1) {
                cout << "Ты убил монстра!! Ты победил с " << hp << " хп.\n";
                cout << "Ты убил монстра и получил 50 монет и 50 xp." << endl;
                cout << "Первый уровень пройден!" << endl;
                myPet.coins += 50;
                myPet.xp += 50;
                cout << "Нажмите 1 чтобы выйти в главное меню." << endl;
                cin >> lobby;

                if (lobby == 1) {
                    break;
                }
            }
            cout << "У монстра " << mhp << " хп.\n";
        }
    }
}

int petLevels(Pet& myPet) {
    int lvlChoice = 0;

    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;

  
    string levelOne = "Первый уровень открыт, нажмите 1 чтобы сыграть.";
    string levelTwo = "Второй уровень открыт, нажмите 2 чтобы сыграть.";
    string levelThree = "Третий уровень открыт, нажмите 3 чтобы сыграть.";
    string levelFour = "Четвертый уровень открыт, нажмите 4 чтобы сыграть.";
    string levelFive = "Пятый уровень открыт, нажмите 5 чтобы сыграть.";
    if (myPet.xp >= 200) {
        lvlChoice = 1;
        cout << levelOne << endl;
    }
    else {
        lvlChoice = 0;
        cout << "Первый уровень заблокирован. Вам надо 500 опыта.\n";
    }
    if (myPet.xp >= 500) {
        lvlChoice = 2;
        cout << levelTwo << endl;
    }
    else {
        lvlChoice = 0;
        cout << "Второй уровень заблокирован. Вам надо 500 опыта.\n";
    }
    if (myPet.xp >= 1000) {
        lvlChoice = 3;
        cout << levelThree << endl;
    }
    else {
        lvlChoice = 0;
        cout << "Третий уровень заблокирован. Вам надо 1000 опыта.\n";
    }
    if (myPet.xp >= 2000) {
        lvlChoice = 4;
        cout << levelFour << endl;
    }
    else {
        lvlChoice = 0;
        cout << "Четвертый уровень заблокирован. Вам надо 2000 опыта.\n";
    }
    if (myPet.xp >= 5000) {
        lvlChoice = 5;
        cout << levelFive << endl;
    }
    else {
        lvlChoice = 0;
        cout << "Пятый уровень заблокирован. Вам надо 5000 опыта.\n";
    }
    cout << "Выберите уровень" << endl;
    cin >> lvlChoice;
    if (lvlChoice == 1 && myPet.xp >= 200) {
        battleOneLvl(myPet);
    }
    if (lvlChoice == 2 && myPet.xp >= 500) {
        battleTwoLvl(myPet);
    }
    if (lvlChoice == 3 && myPet.xp >= 1000) {
        battleThreeLvl(myPet);
    }
    if (lvlChoice == 4 && myPet.xp >= 2000) {
        battleFourLvl(myPet);
    }
    if (lvlChoice == 5 && myPet.xp >= 5000) {
        battleFiveLvl(myPet);
    }
    else {
        cout << "Уровень заблокирован, попробуйте позже." << endl;
    }
    return 0;
}

bool itemExists(vector<Item>& inventory, string itemName) {
  for (int i = 0; i < inventory.size(); ++i) {
      if (inventory[i].name == itemName) {
          return true;
      }
  }
  return false;
}

void deleteOneQuantityOfItem(vector<Item>& inventory, string itemToDelete) {
  for (int i = 0; i < inventory.size(); ++i) {
      if (inventory[i].name == itemToDelete) {
          inventory[i].quantity--; 
      }
      if (inventory[i].quantity == 0) {
          cout << "Предмет " << inventory[i].name << " удален полностью из инвентаря" << endl;
          inventory.erase(inventory.begin() + i);
      }
  }
}

void craftItems(vector<Item>& inventory) {
    if (itemExists(inventory, "Щит") && itemExists(inventory, "Меч")) {
        char userChoice;
        cout << "Есть возможность скрафтить щитомеч, используя предметы 'Щит' и 'Меч'. Начать крафт? (y / n)" << endl;
        cin >> userChoice;
        if (userChoice == 'Y' || userChoice == 'y') {
            cout << "1 щит удален из инвентаря" << endl;
            deleteOneQuantityOfItem(inventory, "Щит");

            cout << "1 меч удален из инвентаря" << endl;
            deleteOneQuantityOfItem(inventory, "Меч");

            addItem(inventory, "Щитомеч", 1, 500, 3);
            cout << "Щитомеч редкости " << 3 << " добавлен в инвентарь!" << endl;
        }
        else {
            cout << "Крафт отменен" << endl;
        }

    }
   if (itemExists(inventory, "Доспехи") && itemQuantity(inventory, "Доспехи") >= 4) {
        char userChoice;
        cout << "Есть возможность скрафтить эпические доспехи, используя 4 предмета 'Доспехи'. Начать крафт? (y / n)" << endl;
        cin >> userChoice;
        if (userChoice == 'Y' || userChoice == 'y') {
            for (int i = 0; i < 4; ++i) {
                cout << "1 доспех был удален из инвентаря" << endl;
                deleteOneQuantityOfItem(inventory, "Доспехи");
            }

            addItem(inventory, "Эпические доспехи", 1, 1000, 5);
            cout << "Эпические доспехи редкости " << 5 << " добавлены в инвентарь!" << endl;
        }
        else {
            cout << "Крафт отменен" << endl;
        }
    }

    if (itemExists(inventory, "Нож")) {
        char userChoice;
        cout << "Есть возможность скрафтить редкий нож, используя 2 предмета 'Нож'. Начать крафт? (y / n)" << endl;
        cin >> userChoice;
        if (userChoice == 'Y' || userChoice == 'y') {
            for (int i = 0; i < 2; ++i) {
                cout << "1 нож был удален из инвентаря" << endl;
                deleteOneQuantityOfItem(inventory, "Нож");
            }

            addItem(inventory, "Редкий нож", 1, 300, 4);
            cout << "Редкий нож редкости " << 4 << " добавлен в инвентарь!" << endl;
        }
        else {
            cout << "Крафт отменен" << endl;
        }
    }

    if (itemExists(inventory, "Лук") && itemQuantity(inventory, "Лук") >= 4) {
        char userChoice;
        cout << "Есть возможность скрафтить редкий лук, используя 4 предмета 'Лук'. Начать крафт? (y / n)" << endl;
        cin >> userChoice;
        if (userChoice == 'Y' || userChoice == 'y') {
            for (int i = 0; i < 4; ++i) {
                cout << "1 лук был удален из инвентаря" << endl;
                deleteOneQuantityOfItem(inventory, "Лук");
            }

            addItem(inventory, "Редкий лук", 1, 400, 4);
            cout << "Редкий лук редкости " << 4 << " добавлен в инвентарь!" << endl;
        }
        else {
            cout << "Крафт отменен" << endl;
        }
    }
}

int main() {
    setlocale(LC_ALL, "Russian");
    Pet myPet;
    myPet.level = 1;
    myPet.xp = 200;
    myPet.health = 100;
    myPet.happiness = 100;
    myPet.trips = 0;
    myPet.coins = 0;

    vector<Item> inventory;


    std::cout << "Введите имя вашего питомца: ";
    std::getline(std::cin, myPet.name);

    std::cout << '-' << std::flush;
    sleep(1);
    std::cout << "\b\\" << std::flush;
    sleep(1);
    std::cout << "\b|" << std::flush;
    sleep(1);
    std::cout << "\b/" << std::flush;
    sleep(1);
    std::cout << "\b-" << std::flush;

    bool isRunning = true;
    while (isRunning) {
        displayPet(myPet);
        displayMenu();

        int choice;
        std::cout << "Выберите действие: ";
        std::cin >> choice;
        cout << "--------------------------" << endl;

        switch (choice) {
        case 1:
            // Check for cooldown
            if (kdSetPlayPet > 0) {
                cout << "Вы уже играли с питомцем. Попробуйте позже." << endl;
                break;
            }

            // If not on cooldown, play with the pet
            if (kdSetPlayPet == 0) {
                kdSetPlayPet = COOLDOWN_TIME;
                myPet.coins++;
                myPet.xp = play(myPet);
                cout << "\nВы получили 20 опыта и 1 монету.";
                cout << "\nТекущий уровень xp: " << myPet.xp;
                cout << "\nДо следующего уровня: " << xpToNextlevel(myPet.level) << " xp\n";
                if (myPet.xp >= xpToNextlevel(myPet.level)) {
                    myPet.level++;
                    cout << "\nУровень повышен до " << myPet.level;
                }

                thread cooldownTimer([&] {
                    this_thread::sleep_for(chrono::seconds(COOLDOWN_TIME));
                    kdSetPlayPet = 0;
                    });
                cooldownTimer.detach();
            }
            break;

        case 2:
            myPet.trips = petLevels(myPet);
            break;
        case 3:
            miniGame(myPet);
            break;
        case 4:
            shop(inventory, myPet);
            break;
        case 5:
            printInventory(inventory);
            break;
        case 6:
             craftItems(inventory);
            break;
        case 7:
            isRunning = false;
            break;
        default:
            std::cout << "Неверный выбор. Пожалуйста, попробуйте снова." << std::endl;
        }
    }

    return 0;
}
